<!doctype html>

<html lang="bs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Katalog</title>

<style>
body{font-family:system-ui;margin:0;padding:16px;background:#f6f6f6;}
.top{position:sticky;top:0;z-index:100;background:#f6f6f6;display:flex;gap:8px;align-items:center;padding-bottom:10px;margin-bottom:12px;}
input,select{padding:10px;border:1px solid #ddd;border-radius:10px;background:#fff;}
#q{flex:1;min-width:0;}
#group,#cols{flex:0 0 auto;}
.cartBtn{background:#111;color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700;}

.grid{display:grid;gap:12px;}

.card{position:relative;background:#fff;border-radius:14px;padding:10px;box-shadow:0 1px 6px rgba(0,0,0,.08);transition:.2s ease;}
.card-akcija{background:linear-gradient(0deg,#fafd25,#fc9595);border:1px solid #f53636;}
.card-11{background:linear-gradient(0deg,#cbe6fc,#0673f0);border:1px solid #498ef5;}
.card:hover{box-shadow:0 4px 14px rgba(0,0,0,.15);transform:translateY(-2px);}

.img{width:100%;aspect-ratio:4/3;object-fit:contain;border-radius:10px;background:#fff;}

.badge{position:absolute;top:8px;left:8px;padding:6px 10px;font-size:12px;font-weight:700;color:#fff;border-radius:10px;z-index:5;}
.badge-akcija{background:#d32f2f;}
.badge-novo{background:#2e7d32;}
.badge-11{background:#0821ff;}
.badge-istek{background:#ef6c00;}
.badge-stize{background:#ac15c0;}

.t{font-weight:700;margin:8px 0 4px;}
.meta{font-size:13px;color:#333;line-height:1.4;}

.qtybox{display:flex;gap:6px;margin-top:8px;}
.qtyInput{flex:1;height:38px;padding:0 10px;border:1px solid #ccc;border-radius:10px;font-size:15px;}
.qtybox button{height:38px;padding:0 14px;border:none;background:#111;color:#fff;font-weight:600;border-radius:10px;white-space:nowrap;}

.addedLabel{
  flex:1;
  height:38px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#2e7d32;
  color:#fff;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
.addedLabel:active{transform:scale(.96);}

.cartPopup{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:999;}
.cartBox{background:#fff;width:95%;max-width:420px;border-radius:14px;padding:18px;max-height:90vh;overflow:auto;}
.cartItem{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee;padding:8px 0;font-size:14px;gap:8px;}
.cartItem input{width:60px;text-align:center;padding:6px;border-radius:8px;border:1px solid #ccc;}
.cartItem button{background:none;border:none;font-size:18px;cursor:pointer;}

.cartBox input{width:100%;box-sizing:border-box;}
.sendBtn{width:100%;margin-top:14px;padding:12px;border:none;border-radius:10px;background:#2e7d32;color:#fff;font-weight:700;font-size:16px;}

/* ================= MOBILE FIX ================= */
@media (max-width: 700px){

  .card{
    padding:10px;
  }

  .qtybox{
    display:flex;
    flex-direction:column; /* input iznad dugmeta */
    gap:6px;
  }

  .qtyInput{
    width:100%;
    min-width:0;
    box-sizing:border-box;
  }

  .qtybox button{
    width:100%;
    padding:10px 0;
  }

  .addedLabel{
    width:100%;
  }

}



</style>

</head>

<body>

<div class="top">
  <input id="q" placeholder="Pretraga: naziv, ≈°ifra, grupa...">
  <select id="group"><option value="">Sve grupe</option></select>
  <select id="cols">
    <option value="1">Prikaz 1</option>
    <option value="2">Prikaz 2</option>
    <option value="3" selected>Prikaz 3</option>
    <option value="4">Prikaz 4</option>
  </select>
  <button class="cartBtn" onclick="openCart()">üõí Korpa</button>
</div>

<div id="grid" class="grid"></div>

<div id="cartPopup" class="cartPopup">
  <div class="cartBox">
    <h3>Va≈°a narud≈æba</h3>
    <div id="cartItems"></div>

<br>
<input id="firma" placeholder="Naziv firme"><br><br>
<input id="osoba" placeholder="Kontakt osoba - (nije obavezno)"><br><br>
<input id="telefon" placeholder="Telefon - (nije obavezno)">

<button class="sendBtn" onclick="sendOrder()">Po≈°alji narud≈æbu</button>
<br><br>
<button onclick="closeCart()">Zatvori</button>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script src="app.js"></script>

<script>
function openCart(){
  renderCart();
  document.getElementById("cartPopup").style.display="flex";
}
function closeCart(){
  document.getElementById("cartPopup").style.display="none";
}

document.getElementById("cartPopup").addEventListener("click",e=>{
  if(e.target.id==="cartPopup")closeCart();
});
document.addEventListener("keydown",e=>{
  if(e.key==="Escape")closeCart();
});

["firma","osoba","telefon"].forEach(id=>{
  const el=document.getElementById(id);
  el.value=localStorage.getItem(id)||"";
  el.oninput=()=>localStorage.setItem(id,el.value);
});

function sendOrder(){

  const firmaEl = document.getElementById("firma");
  const osobaEl = document.getElementById("osoba");
  const telefonEl = document.getElementById("telefon");

  const firma = (firmaEl.value || "").trim();
  const osoba = (osobaEl.value || "").trim();
  const telefon = (telefonEl.value || "").trim();

  const cart = JSON.parse(localStorage.getItem("korpa")||"{}");

  // prazna korpa
  if(!Object.keys(cart).length){
    alert("Korpa je prazna");
    return;
  }

  // firma obavezna
  if(!firma){
    alert("Ne mo≈æe≈° poslati narud≈æbu dok ne upi≈°e≈° naziv firme.");
    firmaEl.focus();
    return;
  }

  // datum
  const now = new Date();
  const datum = now.toLocaleString("bs-BA");

  // tekst maila
  let text=`NARUD≈ΩBA
Datum: ${datum}
Firma: ${firma}
Kontakt osoba: ${osoba || "-"}
Telefon: ${telefon || "-"}

STAVKE:
`;

  for(let s in cart){
    text+=`${cart[s].naziv} x ${cart[s].kolicina}\n`;
  }

  fetch("https://formsubmit.co/ajax/doosubasic@gmail.com", {
    method:"POST",
    headers:{ 'Content-Type':'application/json' },
    body:JSON.stringify({
      subject:"Nova narud≈æba iz kataloga",
      message:text
    })
  })
  .then(res=>{
    if(!res.ok) throw new Error("Slanje nije uspjelo");
    return res.json().catch(()=>({}));
  })
  .then(()=>{
    alert("Narud≈æba poslana ‚úÖ");
    localStorage.removeItem("korpa");
    location.reload();
  })
  .catch(()=>{
    alert("Gre≈°ka: narud≈æba NIJE poslana. Poku≈°aj ponovo.");
  });
}


</script>

</body>
</html>
